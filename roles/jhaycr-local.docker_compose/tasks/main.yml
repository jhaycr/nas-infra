---
- name: Process Docker configurations for each host group
  include_tasks: "1_process_group.yml"
  loop: "{{ group_names }}"
  loop_control:
    loop_var: inventory_group_name

- name: Start Docker stack
  become: yes
  community.docker.docker_compose_v2:
    project_src: "{{ docker_home_compose_path }}"
    state: present
    env_files:
    - .env
    files:
    - docker-compose.yml
    - docker-compose.override.yml
    remove_orphans: true