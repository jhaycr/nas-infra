services:
  igir-base:
    build: 
      context: .
      args:
        USER_ID: ${USER_ID:-1000}
        GROUP_ID: ${GROUP_ID:-1000}
    image: igir-app
    volumes:
      - ${IGIR_DATA_PATH}:/data:rw
      - ${IGIR_TEMP_PATH}:/tmp:rw
    user: appuser
    working_dir: /data
    tty: true
    stdin_open: true
    entrypoint: ["igir"]
    # Security hardening
    #security_opt:
    #  - no-new-privileges:true
    #cap_drop:
    #  - ALL
    # read_only: true
    # network_mode: "none"

  igir:
    extends:
      service: igir-base

  igir-shell:
    extends:
      service: igir-base
    entrypoint: ["/bin/sh"]
    command: []